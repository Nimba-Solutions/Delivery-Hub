public with sharing class DeliveryHubSettingsController {

    public class SettingsDTO {
        @AuraEnabled public Boolean enableNotifications { get; set; }
        
        // Renamed/Mapped fields
        @AuraEnabled public Boolean autoCreateRequest { get; set; } // Maps to AutoCreateRequestFromTicketBool__c
        @AuraEnabled public Boolean autoSendRequest { get; set; }   // Maps to AutoSyncNetworkEntityBool__c
        
        // ... (Other AI/Jira fields remain the same) ...
        @AuraEnabled public Boolean aiSuggestionsEnabled { get; set; }
        @AuraEnabled public Boolean autoGenerateDescriptions { get; set; }
        @AuraEnabled public Boolean aiEstimationEnabled { get; set; }
        @AuraEnabled public String openaiApiKey { get; set; }
        @AuraEnabled public String openaiModel { get; set; }
        @AuraEnabled public Boolean openAiApiTested { get; set; }
        @AuraEnabled public Boolean jiraEnabled { get; set; }
        @AuraEnabled public String jiraInstanceUrl { get; set; }
        @AuraEnabled public String jiraUsername { get; set; }
        @AuraEnabled public String jiraApiToken { get; set; }
        @AuraEnabled public String jiraProjectKey { get; set; }
        @AuraEnabled public Boolean jiraApiTested { get; set; }
    }

    @AuraEnabled
    public static SettingsDTO getSettings() {
        Delivery_Hub_Settings__c settings = Delivery_Hub_Settings__c.getOrgDefaults();
        SettingsDTO dto = new SettingsDTO();

        if (settings != null && settings.Id != null) {
            dto.enableNotifications = settings.EnableNotificationsBool__c;
            
            // Map new fields (using defaults if null)
            dto.autoCreateRequest = (settings.AutoCreateRequestFromTicketBool__c == null) ? true : settings.AutoCreateRequestFromTicketBool__c;
            dto.autoSendRequest = (settings.AutoSyncNetworkEntityBool__c == null) ? true : settings.AutoSyncNetworkEntityBool__c;

            // Map other fields
            dto.aiSuggestionsEnabled = settings.AISuggestionsEnabledBool__c;
            dto.autoGenerateDescriptions = settings.AutoGenerateDescriptionsBool__c;
            dto.aiEstimationEnabled = settings.AIEstimationEnabledBool__c;
            dto.openaiApiKey = settings.OpenAIApiKeyTxt__c;
            dto.openaiModel = settings.OpenAIModelTxt__c;
            dto.openAiApiTested = settings.OpenAiApiTestedBool__c;
            dto.jiraEnabled = settings.JIRAEnabledBool__c;
            dto.jiraInstanceUrl = settings.JIRAInstanceUrl__c;
            dto.jiraUsername = settings.JIRAUsernameTxt__c;
            dto.jiraApiToken = settings.JIRAApiTokenTxt__c;
            dto.jiraProjectKey = settings.JIRAProjectKeyTxt__c;
            dto.jiraApiTested = settings.JIraApiTestedBool__c;
        } else {
            // Fresh Install Defaults
            dto.autoCreateRequest = true;
            dto.autoSendRequest = true;
            dto.enableNotifications = false;
        }
        return dto;
    }

    private static Delivery_Hub_Settings__c getOrCreateSettings() {
        Delivery_Hub_Settings__c settings = Delivery_Hub_Settings__c.getOrgDefaults();
        if (settings == null || settings.Id == null) {
            settings = new Delivery_Hub_Settings__c(SetupOwnerId = UserInfo.getOrganizationId());
        }
        return settings;
    }

    @AuraEnabled
    public static void saveGeneralSettings(Boolean enableNotifications, Boolean autoCreateRequest, Boolean autoSendRequest) {
        Delivery_Hub_Settings__c settings = getOrCreateSettings();
        
        settings.EnableNotificationsBool__c = enableNotifications;
        settings.AutoCreateRequestFromTicketBool__c = autoCreateRequest;
        settings.AutoSyncNetworkEntityBool__c = autoSendRequest;

        SObjectAccessDecision decision = Security.stripInaccessible(
            AccessType.UPSERTABLE, new List<Delivery_Hub_Settings__c>{settings});
        upsert decision.getRecords();
    }

    // ... (Keep existing saveAiSettings, saveOpenAISettings, saveJiraSettings, test methods as is) ...
    // Just ensure they use getOrCreateSettings()
}