/**
 * @name         Delivery Hub
 * @license      BSL 1.1 — See LICENSE.md
 * @description Runs automatically when the Delivery Hub package is installed or upgraded.
 *              Initialises org-level default settings so administrators do not need to
 *              trigger the setup wizard before the package is functional.
 * @author Cloud Nimbus LLC
 */
@SuppressWarnings('PMD.ApexCRUDViolation,PMD.AvoidGlobalModifier')
global class DeliveryHubInstallHandler implements InstallHandler {

    /**
     * @description Entry point called by Salesforce on package install/upgrade.
     * @param context Provides version and install type metadata.
     */
    global void onInstall(InstallContext context) {
        initializeDefaultSettings();
    }

    private static void initializeDefaultSettings() {
        DeliveryHubSettings__c settings = DeliveryHubSettings__c.getOrgDefaults();
        if (settings.Id != null) {
            return; // Already configured — do not overwrite existing settings
        }
        settings = new DeliveryHubSettings__c(
            SetupOwnerId                      = UserInfo.getOrganizationId(),
            EnableNotificationsBool__c        = true,
            AutoCreateWorkRequestBool__c = true,
            AutoSyncNetworkEntityBool__c      = true,
            AISuggestionsEnabledBool__c       = true,
            AutoGenerateDescriptionsBool__c   = true,
            AIEstimationEnabledBool__c        = true,
            EmailNotificationsEnabledBool__c  = false,
            StagesToAutoShareWithDevTeamTxt__c = 'All'
        );
        insert settings;
    }
}
