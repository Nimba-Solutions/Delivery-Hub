<template>
    <div class={rootClass}>

        <!-- ── Normal progress track ── -->
        <template if:false={isCancelled}>
            <div class="tp-track">
                <template for:each={phases} for:item="phase">
                    <div key={phase.index} class={phase.wrapClass}>

                        <!-- Dot row: left-connector · dot · right-connector -->
                        <div class="tp-node-row">
                            <div class={phase.connLeftClass}></div>

                            <div class={phase.dotClass} style={phase.dotStyle}>
                                <template if:true={phase.isCompleted}>
                                    <lightning-icon
                                        icon-name="utility:check"
                                        size="xx-small"
                                        class="tp-check-icon">
                                    </lightning-icon>
                                </template>
                                <template if:true={phase.isCurrent}>
                                    <div class="tp-current-pip" style={phase.pipStyle}></div>
                                </template>
                            </div>

                            <div class={phase.connRightClass}></div>
                        </div>

                        <!-- Label + current-stage chip below the dot -->
                        <div class="tp-label-area">
                            <span class="tp-phase-name" style={phase.labelStyle}>{phase.label}</span>
                            <template if:true={phase.isCurrent}>
                                <span class="tp-stage-chip" style={phase.chipStyle}>{currentStageName}</span>
                            </template>
                        </div>

                    </div>
                </template>

                <!-- Trailing "Done" badge when work item is complete -->
                <template if:true={isDone}>
                    <div class="tp-done-badge">
                        <lightning-icon icon-name="utility:success" size="small" class="tp-done-icon"></lightning-icon>
                        <span class="tp-done-label">Done</span>
                    </div>
                </template>
            </div>
        </template>

        <!-- ── Cancelled state ── -->
        <template if:true={isCancelled}>
            <div class="tp-cancelled-strip">
                <lightning-icon icon-name="utility:ban" size="x-small" class="tp-cancelled-icon"></lightning-icon>
                <span class="tp-cancelled-text">Cancelled</span>
            </div>
        </template>

    </div>
</template>
