<template>
    <template lwc:if={isVisible}>

        <!-- ── Mothership: this org is the Cloud Nimbus host ── -->
        <template lwc:if={status.isMothership}>
            <lightning-card title="Delivery Hub" icon-name="standard:service_territory_member">
                <div class="slds-p-around_medium slds-text-align_center">
                    <lightning-icon icon-name="utility:success" variant="success" size="small" class="slds-m-right_x-small"></lightning-icon>
                    <span class="slds-text-heading_small">This is the Host Org</span>
                </div>
            </lightning-card>
        </template>

        <template lwc:else>

            <!-- ── Loading ── -->
            <template lwc:if={isLoading}>
                <div class="slds-p-around_large slds-text-align_center">
                    <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
                </div>
            </template>

            <template lwc:else>

                <!-- ── Connected: status card (admin home only) ── -->
                <template lwc:if={status.isConnected}>
                    <lightning-card icon-name="utility:connected_apps">
                        <span slot="title">Delivery Hub</span>
                        <div class="slds-p-around_medium">

                            <div class="hs-connected-banner">
                                <lightning-icon icon-name="utility:success" variant="success" size="x-small" class="hs-connected-icon"></lightning-icon>
                                <span class="hs-connected-label">Connected to Cloud Nimbus LLC</span>
                            </div>

                            <div class="hs-detail-grid slds-m-top_small">
                                <div class="hs-detail-row">
                                    <span class="hs-detail-key">Vendor</span>
                                    <span class="hs-detail-val">{status.entity.Name}</span>
                                </div>
                                <div class="hs-detail-row">
                                    <span class="hs-detail-key">Status</span>
                                    <span class="hs-detail-val">{entityStatus}</span>
                                </div>
                                <div class="hs-detail-row">
                                    <span class="hs-detail-key">Sync</span>
                                    <span class="hs-detail-val">Every 15 min</span>
                                </div>
                            </div>

                        </div>
                    </lightning-card>
                </template>

                <!-- ── Not connected: Quickstart ── -->
                <template lwc:else>
                    <lightning-card title="Delivery Hub Setup" icon-name="standard:service_territory_member">
                        <div class="slds-p-around_medium">

                            <div class="slds-text-longform slds-m-bottom_medium">
                                <h3 class="slds-text-heading_medium">Quickstart Setup</h3>
                                <p class="slds-text-body_regular">
                                    Establish a secure connection to Cloud Nimbus LLC.
                                    This will configure your default settings and automatically register
                                    this org so you can start sending requests immediately.
                                </p>
                            </div>

                            <div class="slds-box slds-theme_warning slds-m-bottom_medium">
                                <div class="slds-media slds-media_center">
                                    <div class="slds-media__figure">
                                        <lightning-icon icon-name="utility:warning" size="small"></lightning-icon>
                                    </div>
                                    <div class="slds-media__body">
                                        <p><strong>Admin Action Required:</strong></p>
                                        <p>Ensure this URL is in <strong>Remote Site Settings</strong> before connecting:</p>
                                        <code class="slds-text-color_error">{status.requiredRemoteSite}</code>
                                    </div>
                                </div>
                            </div>

                            <div class="slds-align_absolute-center">
                                <lightning-button
                                    variant="brand"
                                    label="Quickstart Connection"
                                    icon-name="utility:link"
                                    onclick={handleConnect}
                                    disabled={isConnecting}>
                                </lightning-button>
                            </div>

                            <template lwc:if={isConnecting}>
                                <div class="slds-m-top_medium slds-text-align_center">
                                    <lightning-spinner alternative-text="Connecting..." size="small"></lightning-spinner>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_small">{connectingStep}</p>
                                </div>
                            </template>

                        </div>
                    </lightning-card>
                </template>

            </template>
        </template>

    </template>

    <!-- Powered by footer — always visible per BSL 1.1 license terms -->
    <div class="hs-powered-by">
        Powered by <a href="https://cloudnimbusllc.com" target="_blank" rel="noopener noreferrer">Cloud Nimbus LLC</a>
    </div>
</template>
